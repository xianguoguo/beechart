<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:mx="library://ns.adobe.com/flex/mx"
               xmlns:components="cn.alibaba.yid.chart.builder.components.*"
               width="100%"
               height="100%"
               initialize="initApp()">
    <s:layout>
        <s:BasicLayout>
        </s:BasicLayout>
    </s:layout>
    <s:states>
        <s:State name="choosing"/>
        <s:State name="editing"/>
    </s:states>
    <s:transitions>
        <s:Transition fromState="*"
                      toState="*">
            <s:Parallel targets="{[editorMain,chartTypeChoosePage]}"
                        duration="500">
                <s:Fade/>
            </s:Parallel>
        </s:Transition>
    </s:transitions>
    <fx:Declarations>
        <!-- 将非可视元素（例如服务、值对象）放在此处 -->
    </fx:Declarations>
    <fx:Style source="../styles/chartEditor.css"/>
    <fx:Script>
        <![CDATA[
            import bee.chart.builder.events.BuilderEvent;
            
            import flash.events.DataEvent;
            
            import mx.collections.ArrayCollection;
            import mx.events.FlexEvent;
            
            /**
             * 图表的配置信息
             * 在 cn.alibaba.yid.chart.builder.CHART_SETTING 中修改
             */
            [Bindable]
            private var chartsSetting:ArrayCollection = CHART_SETTING;
            
            private function initApp():void
            {
                addEventListener(BuilderEvent.CHART_TYPE_CHANGE, onChartTypeChange);
            }
            
            
            protected function onChartTypeChange(event:DataEvent):void
            {
                toggleState();
                if (currentState === 'editing')
                {
                    editorMain.initView(event.data);
                }
            }
            
            private function toggleState():void
            {
                currentState = (currentState == "choosing" ? "editing" : "choosing");
            }
        ]]>
    </fx:Script>
    <s:Scroller width="100%"
                height="100%">
        <s:Group width="100%"
                 height="100%">
            <s:SkinnableContainer id="appBar"
                                  width="100%"
                                  height="40"
                                  skinClass="cn.alibaba.yid.chart.builder.skins.GradientSCSkin">
                <s:Label left="10"
                         verticalCenter="0"
                         text="图表编辑器"
                         styleName="bigTitleFont"/>
            </s:SkinnableContainer>
            <!-- Choosing -->
            <components:ChartTypeChoosePage id="chartTypeChoosePage"
                                            title="选择图表"
                                            width="336"
                                            height="155"
                                            visible.choosing="true"
                                            visible.editing="false"
                                            includeInLayout.choosing="true"
                                            includeInLayout.editing="false"
                                            chartsSetting="{chartsSetting}"
                                            horizontalCenter="0"
                                            verticalCenter="0"
                                            skinClass="cn.alibaba.yid.chart.builder.skins.ChosePagePanelSkin">
            </components:ChartTypeChoosePage>

            <!-- Editing -->
            <components:EditorMain id="editorMain"
                                   width="100%"
                                   height="100%"
                                   top="{appBar.height+5}"
                                   visible.choosing="false"
                                   visible.editing="true"
                                   includeInLayout.choosing="false"
                                   includeInLayout.editing="true"
                                   chartsSetting="{chartsSetting}"
                                   changeState="toggleState()">
            </components:EditorMain>
        </s:Group>
    </s:Scroller>
</s:Application>
